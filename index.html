<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energiefeld-Animationen</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="performance-styles.css">
    <link rel="icon" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB2aWV3Qm94PSIwIDAgMzIgMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzJiNTc5NztzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNGRhYmY3O3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNiIgcnk9IjYiIGZpbGw9InVybCgjZ3JhZDEpIiAvPgogIDxjaXJjbGUgY3g9IjE2IiBjeT0iMTEiIHI9IjQiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjciIC8+CiAgPHBhdGggZD0iTTgsMjAgUTE2LDE1IDI0LDIwIFExNiwyNSA4LDIwIiBmaWxsPSJ3aGl0ZSIgb3BhY2l0eT0iMC45IiAvPgo8L3N2Zz4K">
    <meta name="description" content="Eine Sammlung interaktiver Canvas-Animationen f√ºr Webprojekte">
    <meta name="theme-color" content="#2b5797">
    
    <!-- Performance Systems -->
    <script src="performance-monitor.js"></script>
    <script src="enhanced-adaptive-quality.js"></script>
    <script src="resource-pool.js"></script>
    <script src="progressive-loader.js"></script>
    <script src="user-count-detector.js"></script>
    <script src="emergency-mode.js"></script>
</head>
<body>
    <header>
        <h1>Energiefeld-Animationen</h1>
        <p>Eine Sammlung interaktiver Canvas-Animationen f√ºr Ihre Webprojekte</p>
    </header>

    <!-- Performance Status Bar -->
    <div class="performance-status-bar">
        <div class="status-indicator" id="status-indicator">
            <div class="status-dot" id="status-dot"></div>
            <div class="status-text" id="status-text">Normal</div>
        </div>
        <div class="metrics-display">
            <span class="metric">FPS: <span id="fps-display">60</span></span>
            <span class="metric">Nutzer: <span id="users-display">1</span></span>
            <span class="metric">Qualit√§t: <span id="quality-display">HIGH</span></span>
        </div>
        <div class="emergency-controls">
            <button class="btn btn-small" id="performance-report-btn">üìä Report</button>
            <button class="btn btn-small" id="emergency-test-btn">üö® Test</button>
        </div>
    </div>

    <main>
        <!-- Category Headers -->
        <div class="category-section" data-category="particles">
            <div class="category-header">
                <h2>üåü Particle-Systeme</h2>
                <button class="toggle-category" data-category="particles" aria-expanded="false">
                    <span class="icon">‚ñ∂</span>
                    <span class="count">2 Animationen</span>
                </button>
            </div>
            <div class="animation-grid collapsed">
                <section class="animation-container" id="energy-field-section">
                    <h2>Freude und Energie</h2>
                    <div class="canvas-wrapper">
                        <canvas id="energy-field-canvas"></canvas>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label for="energy-particles">Partikelanzahl</label>
                            <input type="range" id="energy-particles" min="50" max="500" value="200">
                        </div>
                        <div class="control-group">
                            <label for="energy-speed">Geschwindigkeit</label>
                            <input type="range" id="energy-speed" min="1" max="10" value="5">
                        </div>
                        <div class="control-group">
                            <label for="energy-color">Farbe</label>
                            <input type="color" id="energy-color" value="#ff6b6b">
                        </div>
                        <button class="copy-code-btn" data-animation="energy-field">Code kopieren</button>
                    </div>
                </section>

                <section class="animation-container" id="firework-section">
                    <h2>Feuerwerk</h2>
                    <div class="canvas-wrapper">
                        <canvas id="firework-canvas"></canvas>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label for="firework-frequency">H√§ufigkeit</label>
                            <input type="range" id="firework-frequency" min="1" max="10" value="3">
                        </div>
                        <div class="control-group">
                            <label for="firework-particles">Partikelgr√∂√üe</label>
                            <input type="range" id="firework-particles" min="20" max="200" value="100">
                        </div>
                        <div class="control-group">
                            <label for="firework-color">Farbe</label>
                            <input type="color" id="firework-color" value="#cc5de8">
                        </div>
                        <button class="copy-code-btn" data-animation="firework">Code kopieren</button>
                    </div>
                </section>
            </div>
        </div>

        <div class="category-section" data-category="nature">
            <div class="category-header">
                <h2>üåç Natur-Ph√§nomene</h2>
                <button class="toggle-category" data-category="nature" aria-expanded="false">
                    <span class="icon">‚ñ∂</span>
                    <span class="count">3 Animationen</span>
                </button>
            </div>
            <div class="animation-grid collapsed">
                <section class="animation-container" id="blue-sky-section">
                    <h2>Blauer Himmel</h2>
                    <div class="canvas-wrapper">
                        <canvas id="blue-sky-canvas"></canvas>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label for="sky-clouds">Wolkendichte</label>
                            <input type="range" id="sky-clouds" min="5" max="30" value="15">
                        </div>
                        <div class="control-group">
                            <label for="sky-speed">Windgeschwindigkeit</label>
                            <input type="range" id="sky-speed" min="1" max="10" value="3">
                        </div>
                        <div class="control-group">
                            <label for="sky-color">Himmelsfarbe</label>
                            <input type="color" id="sky-color" value="#4dabf7">
                        </div>
                        <button class="copy-code-btn" data-animation="blue-sky">Code kopieren</button>
                    </div>
                </section>

                <section class="animation-container" id="water-waves-section">
                    <h2>Wasserwellen</h2>
                    <div class="canvas-wrapper">
                        <canvas id="water-waves-canvas"></canvas>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label for="waves-height">Wellenh√∂he</label>
                            <input type="range" id="waves-height" min="5" max="50" value="20">
                        </div>
                        <div class="control-group">
                            <label for="waves-speed">Geschwindigkeit</label>
                            <input type="range" id="waves-speed" min="1" max="10" value="4">
                        </div>
                        <div class="control-group">
                            <label for="waves-color">Wasserfarbe</label>
                            <input type="color" id="waves-color" value="#15aabf">
                        </div>
                        <button class="copy-code-btn" data-animation="water-waves">Code kopieren</button>
                    </div>
                </section>

                <section class="animation-container" id="aurora-section">
                    <h2>Aurora Borealis</h2>
                    <div class="canvas-wrapper">
                        <canvas id="aurora-canvas"></canvas>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label for="aurora-intensity">Intensit√§t</label>
                            <input type="range" id="aurora-intensity" min="1" max="10" value="5">
                        </div>
                        <div class="control-group">
                            <label for="aurora-speed">Geschwindigkeit</label>
                            <input type="range" id="aurora-speed" min="1" max="10" value="3">
                        </div>
                        <div class="control-group">
                            <label for="aurora-color">Farbe</label>
                            <input type="color" id="aurora-color" value="#00ff88">
                        </div>
                        <button class="copy-code-btn" data-animation="aurora">Code kopieren</button>
                    </div>
                </section>
    </div>
    </main>
    
    <!-- Footer -->
    <footer style="text-align: center; padding: 20px; background: #2b5797; color: white; margin-top: 40px;">
        <p>Entwickelt von <a href="mailto:quievreux.consulting@gmail.com" style="color: #4dabf7; text-decoration: none;">Quievreux Consulting</a></p>
        <p style="margin-top: 5px; font-size: 0.9em; opacity: 0.8;">¬© 2025 DreamEdit. Alle Rechte vorbehalten.</p>
    </footer>
    
    <!-- Code Modal -->
    <div id="code-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Animation einbinden</h3>
            <div class="code-tabs">
                <button class="tab-btn active" data-tab="html">HTML</button>
                <button class="tab-btn" data-tab="js">JavaScript</button>
                <button class="tab-btn" data-tab="iframe">iFrame</button>
            </div>
            <div class="tab-content">
                <pre id="code-display"></pre>
                <button id="copy-to-clipboard">In die Zwischenablage kopieren</button>
            </div>
        </div>
    </div>
    
    <script>
        // Hilfsfunktion f√ºr Canvas-Gr√∂√üen
        function resizeCanvases() {
            document.querySelectorAll('.canvas-wrapper canvas').forEach(canvas => {
                const parent = canvas.parentElement;
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight;
            });
        }
        
        // Initial Gr√∂√üen setzen
        window.addEventListener('load', resizeCanvases);
        window.addEventListener('resize', resizeCanvases);
    </script>
    <script src="environment-config.js"></script>
    <script src="adaptive-quality.js"></script>
    <script src="energy-field.js"></script>
    <script src="blue-sky.js"></script>
    <script src="firework.js"></script>
    <script src="water-waves.js"></script>
    <script src="aurora.js"></script>
    <script>
        // Gemeinsamer Code f√ºr Modals und Kopier-Funktionalit√§t
        document.addEventListener('DOMContentLoaded', function() {
            // Stellt sicher, dass die Canvases korrekte Gr√∂√üen haben
            resizeCanvases();
            const modal = document.getElementById('code-modal');
            const closeBtn = document.querySelector('.close-modal');
            const copyButtons = document.querySelectorAll('.copy-code-btn');
            const tabButtons = document.querySelectorAll('.tab-btn');
            const copyToClipboardBtn = document.getElementById('copy-to-clipboard');
            const codeDisplay = document.getElementById('code-display');
            
            let currentAnimation = '';
            
            // Modal √∂ffnen/schlie√üen
            copyButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentAnimation = this.dataset.animation;
                    updateCodeDisplay('html');
                    modal.style.display = 'block';
                });
            });
            
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Tab-Wechsel
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    updateCodeDisplay(this.dataset.tab);
                });
            });
            
            function updateCodeDisplay(tabType) {
                let codeToDisplay = '';
                
                switch(tabType) {
                    case 'html':
                        codeToDisplay = `&lt;!DOCTYPE html&gt;
&lt;html lang="de"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;${currentAnimation} Animation&lt;/title&gt;
    &lt;style&gt;
        body { margin: 0; padding: 0; }
        canvas { display: block; width: 100%; height: 100vh; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;canvas id="${currentAnimation}-canvas"&gt;&lt;/canvas&gt;
    &lt;script src="https://shader.runitfast.xyz/environment-config.js"&gt;&lt;/script&gt;
    &lt;script src="https://shader.runitfast.xyz/${currentAnimation}.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        document.addEventListener('DOMContentLoaded', function() {
            init${currentAnimation.charAt(0).toUpperCase() + currentAnimation.slice(1).replace('-', '')}('${currentAnimation}-canvas');
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;`;
                        break;
                    case 'js':
                        codeToDisplay = `// Animation initialisieren
document.addEventListener('DOMContentLoaded', function() {
    const canvas = document.getElementById('${currentAnimation}-canvas');
    init${currentAnimation.charAt(0).toUpperCase() + currentAnimation.slice(1).replace('-', '')}(canvas.id);
});`;
                        break;
                    case 'iframe':
                        const embedUrl = window.ShaderConfig.getEmbedUrl(currentAnimation);
                        codeToDisplay = `&lt;iframe src="${embedUrl}" width="500" height="300" frameborder="0"&gt;&lt;/iframe&gt;`;
                        break;
                }
                
                codeDisplay.textContent = codeToDisplay;
            }
            
            // In Zwischenablage kopieren
            copyToClipboardBtn.addEventListener('click', function() {
                const textArea = document.createElement('textarea');
                textArea.value = codeDisplay.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                this.textContent = 'Kopiert!';
                setTimeout(() => {
                    this.textContent = 'In die Zwischenablage kopieren';
                }, 2000);
            });
        });
    </script>
    
    <!-- Enhanced Initialization Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Enhanced Shader Animationen v3.0 wird initialisiert...');
            
            // 1. Performance Monitoring starten
            if (window.PerformanceMonitor) {
                console.log('üìä Performance Monitor aktiv');
            }
            
            // 2. User Count Detection starten
            if (window.UserCountDetector) {
                console.log('üë• User Count Detector aktiv');
            }
            
            // 3. Progressive Loader starten
            if (window.ProgressiveLoader) {
                console.log('üì• Progressive Loader aktiv');
                
                // Category Toggle Events
                document.querySelectorAll('.toggle-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const category = this.dataset.category;
                        const grid = document.querySelector(`[data-category="${category}"] .animation-grid`);
                        const isExpanded = this.getAttribute('aria-expanded') === 'true';
                        
                        if (isExpanded) {
                            grid.classList.add('collapsed');
                            grid.classList.remove('expanded');
                            this.setAttribute('aria-expanded', 'false');
                            this.querySelector('.icon').textContent = '‚ñ∂';
                        } else {
                            grid.classList.remove('collapsed');
                            grid.classList.add('expanded');
                            this.setAttribute('aria-expanded', 'true');
                            this.querySelector('.icon').textContent = '‚ñ∂';
                            
                            // Animationen in dieser Kategorie laden
                            if (window.ProgressiveLoader) {
                                window.ProgressiveLoader.loadAnimationsByCategory(category);
                            }
                        }
                    });
                });
            }
            
            // 4. Performance Status Bar aktualisieren
            if (window.PerformanceMonitor && window.UserCountDetector) {
                setInterval(() => {
                    updatePerformanceDisplay();
                }, 1000);
            }
            
            // 5. Emergency Controls
            document.getElementById('performance-report-btn').addEventListener('click', function() {
                showPerformanceReport();
            });
            
            document.getElementById('emergency-test-btn').addEventListener('click', function() {
                testEmergencyMode();
            });
            
            // 6. Enhanced Animation Initialization
            initializeAnimations();
        });
        
        function updatePerformanceDisplay() {
            if (window.PerformanceMonitor) {
                const metrics = window.PerformanceMonitor.getMetrics();
                document.getElementById('fps-display').textContent = Math.round(metrics.fps);
            }
            
            if (window.UserCountDetector) {
                const userCount = window.UserCountDetector.getCurrentUserCount();
                document.getElementById('users-display').textContent = userCount;
            }
            
            if (window.EnhancedAdaptiveQuality) {
                const quality = window.EnhancedAdaptiveQuality.getCurrentQuality();
                document.getElementById('quality-display').textContent = quality.particleMultiplier ? 
                    (quality.particleMultiplier * 100).toFixed(0) + '%' : 'HIGH';
            }
        }
        
        function showPerformanceReport() {
            const reports = [];
            
            if (window.PerformanceMonitor) {
                reports.push(window.PerformanceMonitor.generateReport());
            }
            
            if (window.UserCountDetector) {
                reports.push(window.UserCountDetector.generateReport());
            }
            
            if (window.EnhancedAdaptiveQuality) {
                reports.push(window.EnhancedAdaptiveQuality.generateQualityReport());
            }
            
            if (window.EmergencyMode) {
                reports.push(window.EmergencyMode.generateReport());
            }
            
            console.group('üìä Performance Reports');
            reports.forEach((report, index) => {
                console.log(`Report ${index + 1}:`, report);
            });
            console.groupEnd();
            
            alert(`Performance-Report in Konsole verf√ºgbar (${reports.length} Berichte)`);
        }
        
        function testEmergencyMode() {
            if (window.EmergencyMode) {
                console.log('üö® Emergency Mode Test gestartet');
                
                // Simuliere niedrige FPS
                if (window.PerformanceMonitor) {
                    window.PerformanceMonitor.metrics.fps = 15;
                    window.PerformanceMonitor.triggerAlert('lowFPS', { current: 15, threshold: 25 });
                }
                
                // Simuliere hohe Nutzeranzahl
                if (window.UserCountDetector) {
                    window.UserCountDetector.simulateUserJoin();
                    window.UserCountDetector.simulateUserJoin();
                }
            }
        }
        
        function initializeAnimations() {
            // Bestehende Animationen initialisieren
            const animations = [
                { id: 'energy-field', init: 'initEnergyField' },
                { id: 'blue-sky', init: 'initBlueSky' },
                { id: 'firework', init: 'initFirework' },
                { id: 'water-waves', init: 'initWaterWaves' },
                { id: 'aurora', init: 'initAurora' }
            ];
            
            animations.forEach(animation => {
                const canvas = document.getElementById(`${animation.id}-canvas`);
                if (canvas && window[animation.init]) {
                    try {
                        window[animation.init](canvas.id);
                        console.log(`‚úÖ ${animation.id} Animation initialisiert`);
                        
                        // Beim Performance Monitor registrieren
                        if (window.PerformanceMonitor) {
                            window.PerformanceMonitor.registerAnimation(animation.id, animation.id);
                        }
                    } catch (error) {
                        console.error(`‚ùå Fehler bei ${animation.id} Initialisierung:`, error);
                    }
                }
            });
        }
    </script>
    
    <!-- Footer -->
    <footer style="text-align: center; padding: 20px; background: #2b5797; color: white; margin-top: 40px;">
        <p>Entwickelt von <a href="mailto:quievreux.consulting@gmail.com" style="color: #4dabf7; text-decoration: none;">Quievreux Consulting</a></p>
        <p style="margin-top: 5px; font-size: 0.9em; opacity: 0.8;">¬© 2025 DreamEdit. Alle Rechte vorbehalten.</p>
    </footer>
</body>
</html>